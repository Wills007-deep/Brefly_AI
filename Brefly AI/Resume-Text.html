<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Resume Text</title>
        <link rel="stylesheet" href="./assets/CSS/style.css">
        <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
        <style>
            :root {
                --brefly-gradient: linear-gradient(135deg,#2A1B6F 0%,#3050FF 50%,#6A35FF 100%);
                --color-button : linear-gradient(90deg, #3D8CFF, #6A35FF 50%);
            }
            .gradient-bg {
                background: var(--brefly-gradient);
            }
            .color-button {
                background: var(--color-button);
            }
            .color-button:disabled {
                opacity: 0.6;
                cursor: not-allowed;
            }
            .text-entered {
                border: 3px solid #3D8CFF !important;
                background-color: #f0f8ff !important;
            }
            @import url('https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap');
        </style>
        
        <style type="text/tailwindcss">  
        @theme {        
                --color-primary: #3D8CFF; 
                --color-secondary: #6A35FF;
                --color-background1: #FFFFFF;
                --color-background2: #0A0A0A;
                --color-cadre: #1E1E1E;
                --font-Inter: 'Inter', sans-serif;
                }   
        </style>

        <style>
            /* Centrage horizontal et vertical du placeholder dans le textarea (solution JS pour le vertical) */
            textarea::placeholder {
            text-align: center;
            line-height: 20rem;
            }
        </style>
        <script>
            let hasTextContent = false;

            // Initialize textarea styling and add event listeners
            document.addEventListener('DOMContentLoaded', function() {
                const textarea = document.getElementById('text-input');
                if (textarea) {
                    // Initial styling for placeholder centering
                    textarea.style.display = 'flex';
                    textarea.style.alignItems = 'center';
                    textarea.style.justifyContent = 'center';
                    textarea.style.textAlign = 'center';
                    textarea.style.paddingTop = 'calc(50% - 1.5em)';

                    // Handle text input changes
                    textarea.addEventListener('input', function() {
                        const textContainer = document.getElementById('text-container');
                        if (this.value.trim().length > 0) {
                            hasTextContent = true;
                            textContainer.classList.add('text-entered');
                            // Adjust styling when user starts typing
                            this.style.paddingTop = '1rem';
                            this.style.textAlign = 'left';
                        } else {
                            hasTextContent = false;
                            textContainer.classList.remove('text-entered');
                            // Reset to centered placeholder styling
                            this.style.paddingTop = 'calc(50% - 1.5em)';
                            this.style.textAlign = 'center';
                        }
                    });

                    // Handle focus events
                    textarea.addEventListener('focus', function() {
                        if (this.value.trim().length > 0) {
                            this.style.paddingTop = '1rem';
                            this.style.textAlign = 'left';
                        }
                    });

                    textarea.addEventListener('blur', function() {
                        if (this.value.trim().length === 0) {
                            this.style.paddingTop = 'calc(50% - 1.5em)';
                            this.style.textAlign = 'center';
                        }
                    });
                }

                // Handle form submission - moved inside DOMContentLoaded
                const resumeForm = document.getElementById('resume-form');
                if (resumeForm) {
                    resumeForm.addEventListener('submit', async function(e) {
                        e.preventDefault();
                        
                        // Get form values
                        const userName = document.getElementById('user-name').value.trim();
                        const userEmail = document.getElementById('user-email').value.trim();
                        const action = document.getElementById('action-select').value;
                        const language = document.getElementById('language-select').value;
                        const textInput = document.getElementById('text-input').value.trim();
                        
                        // Validate required fields
                        if (!userName) {
                            showError('Please enter your name.');
                            return;
                        }
                        
                        if (!action) {
                            showError('Please select an action.');
                            return;
                        }
                        
                        if (!language) {
                            showError('Please select a language.');
                            return;
                        }
                        
                        if (!textInput) {
                            showError('Please enter your text content.');
                            return;
                        }

                        // Show loading state
                        showLoading();
                        
                        try {
                            // Prepare the data for webhook (following brefly_frontend.html pattern)
                            const webhookData = {
                                textInput: textInput,
                                contentSource: 'text',
                                action: action,
                                language: language,
                                userName: userName,
                                userEmail: userEmail,
                                fileName: '',
                                timestamp: new Date().toISOString()
                            };

                            console.log('Sending data to webhook:', webhookData);

                            // Send to webhook
                            const response = await fetch('http://localhost:5678/webhook/brefly-ai', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify(webhookData)
                            });

                            const result = await response.json();

                            if (result.success) {
                                // Show success result
                                showResults(result.data.processedContent);
                                
                                // Show success message
                                showMessage('✅ Content processed successfully!', 'success');
                            } else {
                                // Show error
                                showError(`❌ Error: ${result.message || result.error}`);
                            }
                            
                        } catch (error) {
                            console.error('Error:', error);
                            showError('❌ Failed to process content. Please check your connection and try again.');
                        } finally {
                            hideLoading();
                        }
                    });
                }

                                // Copy to clipboard functionality
                const copyBtn = document.getElementById('copy-btn');
                if (copyBtn) {
                    copyBtn.addEventListener('click', function() {
                        const content = document.getElementById('result-content').textContent;
                        navigator.clipboard.writeText(content).then(function() {
                            const btn = document.getElementById('copy-btn');
                            const originalText = btn.textContent;
                            btn.textContent = 'Copied!';
                            setTimeout(() => {
                                btn.textContent = originalText;
                            }, 2000);
                        }).catch(function(err) {
                            console.error('Failed to copy: ', err);
                        });
                    });
                }

                // Download as text file functionality
                const downloadBtn = document.getElementById('download-btn');
                if (downloadBtn) {
                    downloadBtn.addEventListener('click', function() {
                        const content = document.getElementById('result-content').textContent;
                        const userName = document.getElementById('user-name').value.trim();
                        const action = document.getElementById('action-select').value;
                        
                        // Generate appropriate filename based on action
                        let filename;
                        switch(action) {
                            case 'translate':
                                filename = `${userName}_Translation.txt`;
                                break;
                            case 'resume':
                                filename = `${userName}_Summary.txt`;
                                break;
                            case 'analyze':
                                filename = `${userName}_Analysis.txt`;
                                break;
                            case 'extract':
                                filename = `${userName}_KeyPoints.txt`;
                                break;
                            case 'rewrite':
                                filename = `${userName}_Rewritten.txt`;
                                break;
                            default:
                                filename = `${userName}_Result.txt`;
                        }
                        
                        const blob = new Blob([content], { type: 'text/plain' });
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = filename;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);
                    });
                }

                // Initialize the application (following brefly_frontend.html pattern)
                console.log('🤖 Resume Text processor initialized');
            });

            // Show loading state
            function showLoading() {
                const action = document.getElementById('action-select').value;
                const loadingText = document.querySelector('#loading p');
                
                // Update loading message based on action
                switch(action) {
                    case 'translate':
                        loadingText.textContent = 'Translating your text...';
                        break;
                    case 'resume':
                        loadingText.textContent = 'Creating summary...';
                        break;
                    case 'analyze':
                        loadingText.textContent = 'Analyzing your text...';
                        break;
                    case 'extract':
                        loadingText.textContent = 'Extracting key points...';
                        break;
                    case 'rewrite':
                        loadingText.textContent = 'Rewriting your text...';
                        break;
                    default:
                        loadingText.textContent = 'Processing your text...';
                }
                
                document.getElementById('loading').classList.remove('hidden');
                document.getElementById('results').classList.add('hidden');
                document.getElementById('error').classList.add('hidden');
                document.getElementById('generate-btn').disabled = true;
                document.getElementById('generate-btn').textContent = 'Processing...';
            }

            // Hide loading state
            function hideLoading() {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('generate-btn').disabled = false;
                document.getElementById('generate-btn').textContent = 'Process';
            }

            // Show results
            function showResults(content) {
                const action = document.getElementById('action-select').value;
                const resultTitle = document.querySelector('#results h2');
                
                // Update result title based on action
                switch(action) {
                    case 'translate':
                        resultTitle.textContent = 'Translation Result';
                        break;
                    case 'resume':
                        resultTitle.textContent = 'Summary';
                        break;
                    case 'analyze':
                        resultTitle.textContent = 'Analysis Result';
                        break;
                    case 'extract':
                        resultTitle.textContent = 'Key Points';
                        break;
                    case 'rewrite':
                        resultTitle.textContent = 'Rewritten Content';
                        break;
                    default:
                        resultTitle.textContent = 'Result';
                }
                
                document.getElementById('result-content').textContent = content;
                document.getElementById('results').classList.remove('hidden');
                document.getElementById('error').classList.add('hidden');
            }

            // Show error
            function showError(message) {
                document.getElementById('error-message').textContent = message;
                document.getElementById('error').classList.remove('hidden');
                document.getElementById('results').classList.add('hidden');
            }



            // Utility function to show messages (following brefly_frontend.html pattern)
            function showMessage(message, type) {
                // Remove any existing messages
                document.querySelectorAll('.error-message, .success-message').forEach(el => el.remove());
                
                const messageDiv = document.createElement('div');
                messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
                messageDiv.textContent = message;
                messageDiv.style.cssText = `
                    background: ${type === 'error' ? '#ffebee' : '#e8f5e8'};
                    color: ${type === 'error' ? '#c62828' : '#2e7d32'};
                    padding: 15px;
                    border-radius: 8px;
                    margin-top: 15px;
                    border-left: 4px solid ${type === 'error' ? '#c62828' : '#2e7d32'};
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 1000;
                    max-width: 400px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                `;
                
                // Insert message into body
                document.body.appendChild(messageDiv);
                
                // Auto-remove message after 5 seconds
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.remove();
                    }
                }, 5000);
            }


        </script>
    </head>
    <body class="bg-black w-screen h-screen flex-col flex items-center justify-evenly gap-[3rem] pt-[40px] pb-[40px]">
        
        <aside class="flex flex-col items-center justify-around gap-[7rem]"   >
            <section>
                <div class="absolute top-[20px] left-5">
                  <a href="Home-page.html">
                    <img class="w-[40px] h-[40px] md:w-[50px] md:h-[50px] cursor-pointer" src="./assets/image/return-button.png" alt="button">
                  </a>
                </div>
            </section>

            <section >
                <div class="w-[20rem] h-[30rem] bg-cadre flex flex-col items-center justify-center gap-[40px] md:flex md:flex-col-reverse md:items-center md:justify-center md:gap-[40px] md:w-[50rem] md:h-[35rem] rounded-[30px]">
                    <div class="w-[18rem] h-[5rem] bg-[#0e0e0e] flex items-center justify-center gap-[20px] rounded-[15px] md:w-[35rem] md:h-[6rem] md:gap-[5rem] md:justify-around">
                        <a href="./Resume-PDF.html">
                            <div class="w-[7rem] h-[3rem] bg-primary font-bold text-white text-[30px] rounded-full text-center leading-[3rem] cursor-pointer hover:opacity-80">PDF</div>
                        </a>
                        <div class="w-[7rem] h-[3rem] bg-secondary font-bold text-white text-[30px] rounded-full text-center leading-[3rem]">Text</div>
                    </div>

                    <div id="text-container" class="w-[18rem] h-[20rem] bg-white rounded-[20px] flex items-center justify-center md:w-[40rem] md:h-[20rem] md:border-[2rem] md:text-[30px] md:top-[50%]" style="border: #000 solid 5px;">
                        <textarea 
                            id="text-input"
                            class="w-full h-full bg-white rounded-[20px] text-black font-Inter text-[20px] font-bold opacity-[80%] md:text-[30px] resize-none p-4 outline-none border-none text-center flex items-center justify-center"
                            placeholder="Paste your resume text here"
                            style="border: none; box-shadow: none; text-align: center; display: flex; align-items: center; justify-content: center; min-height: 100%; height: 100%;"
                            rows="8"
                        ></textarea>
                    </div>

                </div>
            </section>
        </aside>  

        <form id="resume-form" class="flex flex-col items-center gap-4">
            <div class="flex flex-col gap-4 md:flex-row md:gap-8">
                <input id="user-name" type="text" placeholder="Your Name" required class="bg-white w-[320px] h-[60px] rounded-full text-center font-bold text-[20px] text-black opacity-[80%] outline-none border-none" />
                <input id="user-email" type="email" placeholder="Your Email (optional)" class="bg-white w-[320px] h-[60px] rounded-full text-center font-bold text-[20px] text-black opacity-[80%] outline-none border-none" />
            </div>
            
            <div class="flex flex-col gap-4 md:flex-row md:gap-8">
                <select id="action-select" required class="bg-white w-[320px] h-[60px] rounded-full text-center font-bold text-[20px] text-black opacity-[80%] outline-none border-none appearance-none cursor-pointer" style="background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'none\' stroke=\'currentColor\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'%3e%3cpolyline points=\'6,9 12,15 18,9\'%3e%3c/polyline%3e%3c/svg%3e'); background-repeat: no-repeat; background-position: right 1rem center; background-size: 1em; padding-right: 2.5rem;">
                    <option value="" disabled selected>Select Action</option>
                    <option value="resume">Resume/Summarize</option>
                    <option value="translate">Translate</option>
                    <option value="analyze">Analyze</option>
                    <option value="extract">Extract Key Points</option>
                    <option value="rewrite">Rewrite</option>
                </select>
                
                <select id="language-select" required class="bg-white w-[320px] h-[60px] rounded-full text-center font-bold text-[20px] text-black opacity-[80%] outline-none border-none appearance-none cursor-pointer" style="background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'none\' stroke=\'currentColor\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'%3e%3cpolyline points=\'6,9 12,15 18,9\'%3e%3c/polyline%3e%3c/svg%3e'); background-repeat: no-repeat; background-position: right 1rem center; background-size: 1em; padding-right: 2.5rem;">
                    <option value="" disabled selected>Select Language</option>
                    <option value="French">Français</option>
                    <option value="English">English</option>
                    <option value="Spanish">Español</option>
                    <option value="German">Deutsch</option>
                    <option value="Italian">Italiano</option>
                    <option value="Portuguese">Português</option>
                    <option value="Arabic">العربية</option>
                    <option value="Chinese">中文</option>
                    <option value="Japanese">日本語</option>
                </select>
            </div>
            
            <button id="generate-btn" type="submit" class="w-[16rem] h-[4rem] rounded-full color-button text-white text-[35px] text-center font-bold font-Inter">Process</button>
        </form>

        <!-- Loading indicator -->
        <div id="loading" class="hidden flex flex-col items-center gap-4">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-white"></div>
            <p class="text-white text-lg">Processing your text...</p>
        </div>

        <!-- Results display -->
        <div id="results" class="hidden w-full max-w-4xl mx-auto mt-8 p-6 bg-white rounded-lg">
            <h2 class="text-2xl font-bold mb-4 text-black">Generated Resume</h2>
            <div id="result-content" class="text-black whitespace-pre-wrap"></div>
            <button id="copy-btn" class="mt-4 px-6 py-2 bg-primary text-white rounded-full hover:bg-secondary transition-colors">Copy to Clipboard</button>
            <button id="download-btn" class="mt-4 ml-4 px-6 py-2 bg-secondary text-white rounded-full hover:bg-primary transition-colors">Download as Text</button>
        </div>

        <!-- Error display -->
        <div id="error" class="hidden w-full max-w-4xl mx-auto mt-8 p-6 bg-red-100 border border-red-400 rounded-lg">
            <h2 class="text-xl font-bold mb-2 text-red-800">Error</h2>
            <p id="error-message" class="text-red-700"></p>
        </div>
    </body>
</html>